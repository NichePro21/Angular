<div class="modal-header bg-success text-white">
    <h5 class="modal-title">‚ûï Th√™m h√†ng</h5>
    <button type="button" class="btn-close btn-close-white" aria-label="Close" (click)="activeModal.dismiss()"></button>
</div>

<div class="modal-body">
    <!-- Tabs -->
    <ul ngbNav #nav="ngbNav" [(activeId)]="activeTab" class="nav nav-tabs mb-3">
        <li [ngbNavItem]="1">
            <a ngbNavLink>Th√¥ng tin</a>
            <ng-template ngbNavContent>
                <!-- üëá N·ªòI DUNG FORM C·ª¶A B·∫†N ·ªû ƒê√ÇY -->
                <form class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">M√£ h√†ng</label>
                        <input class="form-control bg-light"
                            [value]="nextProductId !== null ? nextProductId : 'ƒêang t·∫£i...'" placeholder="T·ª± ƒë·ªông"
                            disabled />
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Gi√° v·ªën<i class="ml-1 fas fa-info-circle text-secondary"
                                data-toggle="tooltip" data-placement="right" title="GiaÃÅ nh√¢Ã£p vaÃÄo cuÃâa saÃân ph√¢Ãâm"
                                style="cursor: pointer;"></i></label>
                        <input type="number" class="form-control" [(ngModel)]="capitalPrice" name="capitalPrice"
                            required />
                        <div class="text-danger" *ngIf="capitalPriceError">{{ capitalPriceError }}</div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">
                            M√£ v·∫°ch
                            <i class="ml-1 fas fa-info-circle text-secondary" data-toggle="tooltip"
                                data-placement="right" title="M√£ v·∫°ch th∆∞·ªùng ƒë∆∞·ª£c t·∫°o ra b·ªüi nh√† s·∫£n xu·∫•t"
                                style="cursor: pointer;"></i>
                        </label>
                        <input type="text" class="form-control" [(ngModel)]="barcode" name="barcode" />
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">Gi√° b√°n<i class="ml-1 fas fa-info-circle text-secondary"
                                data-toggle="tooltip" data-placement="right" title="GiaÃÅ ni√™m y√™ÃÅt cuÃâa saÃân ph√¢Ãâm"
                                style="cursor: pointer;"></i></label>
                        <input type="number" class="form-control" [(ngModel)]="productPrice" name="price" required />
                        <div class="text-danger" *ngIf="priceError">{{ priceError }}</div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">T√™n haÃÄng</label>
                        <input type="text" class="form-control" [(ngModel)]="productName" name="productName" required
                            placeholder="T√™n saÃân ph√¢Ãâm" />
                        <div class="text-danger" *ngIf="productNameError">{{ productNameError }}</div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">T·ªìn kho<i class="ml-1 fas fa-info-circle text-secondary"
                                data-toggle="tooltip" data-placement="right"
                                title="S√¥ÃÅ l∆∞∆°Ã£ng saÃân ph√¢Ãâm coÃÄn laÃ£i trong kho haÃÄng"
                                style="cursor: pointer;"></i></label>
                        <input class="form-control" *ngIf="stock" name="stock" />
                    </div>
                    <div class="col-md-6 mt-2">
                        <label class="form-label mr-2">Nh√≥m h√†ng</label>

                        <div class="input-group">
                            <select class="form-control" [(ngModel)]="selectedCateId" name="categories" required
                                #categoriesSelect="ngModel">
                                <option *ngFor="let cate of categories" [value]="cate.id">{{ cate.name }}</option>
                            </select>

                            <div class="input-group-append">
                                <button type="button" class="btn btn-outline-success" (click)="openAddCategoryModal()">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>

                        <div class="text-danger mt-1" *ngIf="categoriesSelect.invalid && categoriesSelect.touched">
                            Vui l√≤ng ch·ªçn nh√≥m h√†ng.
                        </div>
                    </div>
                    <!-- Modal th√™m nh√≥m h√†ng -->
                    <div class="modal fade" id="addCategoryModal" tabindex="-1" role="dialog"
                        aria-labelledby="addCategoryModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Th√™m nh√≥m h√†ng</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="ƒê√≥ng"
                                        (click)="closeCategoriesModel()">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <label class="text-danger">T√™n nh√≥m</label>
                                    <input [(ngModel)]="newCategoryName" class="form-control" name="newCategoryName"
                                        placeholder="T√™n nh√≥m h√†ng m·ªõi" />
                                    <div *ngIf="categoryErrorMsg" class="text-danger mt-2">
                                        {{ categoryErrorMsg }}
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal"
                                        (click)="closeCategoriesModel()">Hu·ª∑</button>
                                    <button type="button" class="btn btn-primary" (click)="addCategory()">Th√™m</button>
                                </div>
                            </div>
                        </div>
                    </div>


                    <div class="col-md-6">
                        <label class="form-label">Tr·ªçng l∆∞·ª£ng<i class="ml-1 fas fa-info-circle text-secondary"
                                data-toggle="tooltip" data-placement="right"
                                title="S∆∞Ãâ duÃ£ng ƒë√™Ãâ tiÃÅnh troÃ£ng l∆∞∆°Ã£ng khi giao haÃÄng"
                                style="cursor: pointer;"></i></label>
                        <div class="input-group">
                            <input class="form-control mr-2" placeholder="" />
                            <select class="form-select">
                                <option>mg</option>
                                <option>g</option>
                                <option>kg</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6 mt-2">
                        <label class="form-label">Th∆∞∆°ng hi·ªáu</label>

                        <div class="input-group mr-2">
                            <select class="form-control" [(ngModel)]="selectedBrandId" name="brand" required
                                #brandSelect="ngModel">
                                <option *ngFor="let brand of brands" [value]="brand.id">{{ brand.name }}</option>
                            </select>

                            <div class="input-group-append">
                                <button type="button" class="btn btn-outline-success" (click)="openAddBrandModal()">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>

                        <div class="text-danger mt-1" *ngIf="brandSelect.invalid && brandSelect.touched">
                            Vui l√≤ng ch·ªçn th∆∞∆°ng hi·ªáu.
                        </div>
                    </div>
                    <!-- Modal -->
                    <div class="modal fade" id="addBrandModal" tabindex="-1" role="dialog"
                        aria-labelledby="addBrandModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="addBrandModalLabel">Th√™m th∆∞∆°ng hi·ªáu m·ªõi</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="ƒê√≥ng"
                                        (click)="closeBrandModel()">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <label class="text-danger">T√™n th∆∞∆°ng hi·ªáu</label>
                                    <input [(ngModel)]="newBrandName" class="form-control" name="newBrandName"
                                        placeholder="T√™n th∆∞∆°ng hi·ªáu m·ªõi" />

                                    <!-- Hi·ªÉn th·ªã l·ªói -->
                                    <div *ngIf="brandErrorMsg" class="text-danger mt-2">
                                        {{ brandErrorMsg }}
                                    </div>
                                </div>

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal"
                                        (click)="closeBrandModel()">Hu·ª∑</button>
                                    <button type="button" class="btn btn-primary" (click)="addBrand()">Th√™m</button>
                                </div>
                            </div>
                        </div>
                    </div>



                    <div class="col-md-6">
                        <label class="form-label">K√≠ch th∆∞·ªõc<i class="ml-1 fas fa-info-circle text-secondary"
                                data-toggle="tooltip" data-placement="right"
                                title="TiÃÅnh kiÃÅch th∆∞∆°ÃÅc cuÃâa saÃân ph√¢Ãâm theo ƒë∆°n viÃ£ c∆° baÃân."
                                style="cursor: pointer;"></i></label>
                        <div class="input-group">
                            <input class="form-control mr-2" placeholder="R·ªông" />
                            <input class="form-control mr-2" placeholder="D√†i" />
                            <select class="form-select">
                                <option>mm</option>
                                <option>cm</option>
                                <option>m</option>
                            </select>
                        </div>
                    </div>
                    <label class="fw-bold">Ch·ªçn m√†u s·∫Øc:</label>
                    <div class="d-flex flex-wrap gap-2 mb-2 position-relative">
                        <div *ngFor="let color of selectedColors" class="color-box selected" [title]="color.name"
                            [ngStyle]="{ 'background-color': color.hexCode }">
                            <span class="checkmark">‚úî</span>
                            <span class="remove" (click)="removeColor(color)">√ó</span>
                        </div>
                        <div class="color-box add-box" (click)="openColorPicker = !openColorPicker"><span>+</span></div>
                    </div>

                    <!-- Modal ch·ªçn m√†u -->
                    <div *ngIf="openColorPicker" class="color-modal">
                        <div class="color-grid">
                            <div *ngFor="let color of allColors" class="color-box"
                                [ngClass]="{ 'selected': isSelected(color.id) }"
                                [ngStyle]="{ 'background-color': color.hexCode }" (click)="toggleColor(color)">
                                <span *ngIf="isSelected(color.id)" class="checkmark">‚úî</span>
                            </div>
                        </div>

                        <div class="mt-2">
                            <input type="color" class="add-Colors" (change)="addNewColor($event)" />
                            <button class="btn btn-sm btn-secondary ml-2 m-auto"
                                (click)="openColorPicker = false">ƒê√≥ng</button>
                        </div>
                    </div>





                </form>

                <div class="mt-4">
                    <label class="form-label">
                        H√¨nh ·∫£nh
                        <i class="ml-1 fas fa-info-circle text-secondary" data-toggle="tooltip" data-placement="right"
                            title="HiÃÄnh aÃânh mi√™u taÃâ cuÃâa saÃân ph√¢Ãâm seÃÉ ƒë∆∞∆°Ã£c hi√™Ãân thiÃ£."
                            style="cursor: pointer;"></i>
                    </label>

                    <div class="row">
                        <div class="col-3 col-md-2 mb-2" *ngFor="let img of images; let i = index">
                            <div class="position-relative border border-secondary rounded shadow-sm bg-white d-flex align-items-center justify-content-center"
                                style="height: 100px; cursor: pointer;" (click)="selectImage(i)">
                                <ng-container *ngIf="img.preview; else placeholder">
                                    <img [src]="img.preview" alt="Preview" class="img-fluid w-100 h-100 rounded"
                                        style="object-fit: cover;">
                                </ng-container>

                                <ng-template #placeholder>
                                    <img src="https://developers.elementor.com/docs/assets/img/elementor-placeholder-image.png"
                                        alt="Placeholder" class="img-fluid opacity-50 p-2"
                                        style="max-height: 100px; object-fit: contain;">
                                </ng-template>
                            </div>
                        </div>
                    </div>

                    <!-- input hidden cho m·ªói ·∫£nh -->
                    <input type="file" class="d-none" #fileInput (change)="onImageChange($event, selectedImageIndex)"
                        accept="image/*">
                    <div class="text-danger" *ngIf="imageError">{{ imageError }}</div>

                </div>



                <div class="form-check form-switch mt-4">
                    <input class="form-check-input" type="checkbox" id="directSale">
                    <label class="form-check-label" for="directSale">B√°n tr·ª±c ti·∫øp</label>
                </div>
            </ng-template>
        </li>

        <li [ngbNavItem]="2">
            <a ngbNavLink>M√¥ t·∫£ chi ti·∫øt</a>
            <ng-template ngbNavContent>
                <div class="card border">
                    <div class="card-body">
                        <h6 class="font-weight-bold mb-3">ƒê·ªãnh m·ª©c t·ªìn</h6>
                        <div class="form-row align-items-center">
                            <div class="col-auto">
                                <label class="mr-2 mb-0">√çt nh·∫•t</label>
                                <i class="fa fa-info-circle text-muted" title="S·ªë l∆∞·ª£ng t·ªìn kho t·ªëi thi·ªÉu."></i>
                            </div>
                            <div class="col">
                                <input type="number" class="form-control" placeholder="0" [(ngModel)]="minStock"
                                    name="minStock" required>
                            </div>
                            <div class="col-auto">
                                <label class="mr-2 mb-0">Nhi·ªÅu nh·∫•t</label>
                                <i class="fa fa-info-circle text-muted" title="S·ªë l∆∞·ª£ng t·ªìn kho t·ªëi ƒëa."></i>
                            </div>
                            <div class="col">
                                <input type="number" class="form-control" placeholder="999" required
                                    [(ngModel)]="maxStock" name="maxStock">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card border mt-3">
                    <div class="card-body">
                        <h6 class="font-weight-bold mb-2">M√¥ t·∫£</h6>
                        <div class="text-danger" *ngIf="descriptionError">{{ descriptionError }}</div>
                        <textarea class="form-control" rows="4" [(ngModel)]="description" name="description"
                            placeholder="Nh·∫≠p m√¥ t·∫£ chi ti·∫øt..."></textarea>
                    </div>
                </div>

                <div class="card border mt-3">
                    <div class="card-body">
                        <h6 class="font-weight-bold mb-2">M·∫´u ghi ch√∫ (h√≥a ƒë∆°n, ƒë·∫∑t h√†ng)</h6>
                        <textarea class="form-control" rows="3" [(ngModel)]="note" name="note"
                            placeholder="Nh·∫≠p ghi ch√∫ hi·ªÉn th·ªã tr√™n h√≥a ƒë∆°n ho·∫∑c ƒë∆°n h√†ng..."></textarea>
                    </div>
                </div>
            </ng-template>


        </li>
    </ul>

    <div [ngbNavOutlet]="nav"></div>

</div>

<div class="modal-footer">
    <button class="btn btn-success" (click)="save()">L∆∞u</button>
    <button class="btn btn-secondary" (click)="activeModal.dismiss()">B·ªè qua</button>
</div>